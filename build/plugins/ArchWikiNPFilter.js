// Generated by CoffeeScript 2.0.3
// Wiki Monkey - MediaWiki bot and editor-assistant user script
// Copyright (C) 2011 Dario Giovannetti <dev@dariogiovannetti.net>

// This file is part of Wiki Monkey.

// Wiki Monkey is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// Wiki Monkey is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.

// You should have received a copy of the GNU General Public License
// along with Wiki Monkey.  If not, see <http://www.gnu.org/licenses/>.
var CSS, Plugin;

({Plugin} = require('./_Plugin'));

CSS = require('../../auxiliary/lib.js.generic/dist/CSS');

module.exports.ArchWikiNPFilter = (function() {
  class ArchWikiNPFilter extends Plugin {
    main_newpages() {
      var contentDiv, i, language, len, li, liList, link, pureTitle, ul;
      CSS.addStyleElement("#mw-content-text > h5 {background-color:#afa;}");
      contentDiv = $('#mw-content-text');
      ul = contentDiv.find('ul').first();
      liList = ul.children('li');
      for (i = 0, len = liList.length; i < len; i++) {
        li = liList[i];
        link = $(li).find('a.mw-newpages-pagename').first();
        [pureTitle, language] = this.WM.ArchWiki.detectLanguage(link[0].title);
        if (language !== this.conf.default_language) {
          this.moveArticle(contentDiv, li, language);
        }
      }
      return this.WM.Log.logInfo("Grouped articles by language");
    }

    moveArticle(contentDiv, li, language) {
      var HLang, i, langFound, langHs, len, ul;
      langHs = contentDiv.children('h5');
      langFound = false;
      for (i = 0, len = langHs.length; i < len; i++) {
        HLang = langHs[i];
        if (HLang.innerHTML === language) {
          ul = $(HLang).next().append(li);
          langFound = true;
          break;
        }
      }
      if (!langFound) {
        return contentDiv.append($('<h5>').text(language), $('<ul>').append(li));
      }
    }

  };

  ArchWikiNPFilter.conf_default = {
    enabled: true,
    option_label: "Default filter",
    default_language: "English"
  };

  return ArchWikiNPFilter;

})();
