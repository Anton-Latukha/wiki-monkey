// Generated by CoffeeScript 2.0.3
// Wiki Monkey - MediaWiki bot and editor-assistant user script
// Copyright (C) 2011 Dario Giovannetti <dev@dariogiovannetti.net>

// This file is part of Wiki Monkey.

// Wiki Monkey is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// Wiki Monkey is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.

// You should have received a copy of the GNU General Public License
// along with Wiki Monkey.  If not, see <http://www.gnu.org/licenses/>.

// Initialize the libraries immediately (especially babel-polyfill)
var ArchWiki_, Bot_, Cat_, Cfg_, Diff_, Editor_, Filters_, Interlanguage_, Log_, MW_, Menu_, Mods_, Parser_, Tables_, UI_, Upgrade, WhatLinksHere_;

require('./libs');

// The ArchPackages module is currently unusable
// ArchPackages_ = require('./ArchPackages').ArchPackages
ArchWiki_ = require('./ArchWiki').ArchWiki;

Bot_ = require('./Bot').Bot;

Cat_ = require('./Cat').Cat;

Cfg_ = require('./Cfg').Cfg;

Diff_ = require('./Diff').Diff;

Editor_ = require('./Editor').Editor;

Filters_ = require('./Filters').Filters;

Interlanguage_ = require('./Interlanguage').Interlanguage;

Log_ = require('./Log').Log;

Menu_ = require('./Menu').Menu;

Mods_ = require('./Mods').Mods;

MW_ = require('./MW').MW;

Parser_ = require('./Parser').Parser;

Tables_ = require('./Tables').Tables;

UI_ = require('./UI').UI;

Upgrade = require('./Upgrade');

WhatLinksHere_ = require('./WhatLinksHere').WhatLinksHere;

module.exports.WM = (function() {
  var VERSION;

  class WM {
    constructor(default_config, ...installed_plugins) {
      this._onready = this._onready.bind(this);
      this.version = VERSION;
      mw.loader.using(['mediawiki.api.edit', 'mediawiki.notification']).done(() => {
        return $(() => {
          return this._onready(default_config, installed_plugins);
        });
      });
    }

    _onready(default_config, installed_plugins) {
      var Plugin, i, len, pname;
      // The ArchPackages module is currently unusable
      // @ArchPackages = new ArchPackages_(this)
      this.ArchWiki = new ArchWiki_(this);
      this.Bot = new Bot_(this);
      this.Cat = new Cat_(this);
      this.Cfg = new Cfg_(this);
      this.Diff = new Diff_(this);
      this.Editor = new Editor_(this);
      this.Filters = new Filters_(this);
      this.Interlanguage = new Interlanguage_(this);
      this.Log = new Log_(this);
      this.Menu = new Menu_(this);
      this.Mods = new Mods_(this);
      this.MW = new MW_(this);
      this.Parser = new Parser_(this);
      this.Tables = new Tables_(this);
      this.UI = new UI_(this);
      this.Upgrade = new Upgrade(this);
      this.WhatLinksHere = new WhatLinksHere_(this);
      this.Plugins = {};
      for (i = 0, len = installed_plugins.length; i < len; i++) {
        [pname, Plugin] = installed_plugins[i];
        this.Plugins[pname] = new Plugin(this);
      }
      this.Upgrade.check_and_notify();
      this.Cfg._load(default_config);
      return this.UI._makeUI();
    }

  };

  // The build script updates the version number
  VERSION = '4.0.0';

  return WM;

})();
